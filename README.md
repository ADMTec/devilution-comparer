# Devilution-comparer

Small binary comparison helper tool for devilution.

Generates an orig.asm and a compare.asm in the current directory and can watch the respective *.pdb for changes.

Use `--help` for parameter info.

Example call:

```plain
devilution-comparer path\to\Diablo_orig.exe devilution\bld\WinRel\Diablo.exe 0x303EF InitMonsterTRN -w
```

## Requirements

This uses Rust in the 2018 edition (so currently nightly only).

Since the `pdb` crate doesn't support the old PDB file format generated by VC++ < 7 yet,
you will need to put `cvdump.exe` from https://github.com/Microsoft/microsoft-pdb/tree/master/cvdump
into the folder of the binary. If you aren't on windows, this tool tries to run `wine cvdump.exe` instead.

## `--help`

```plain
Generates orig.asm and compare.asm in the current working directory. Finds the function specified in the devilution
binary, disassembles it, then disassembles the original binary with the same length at the specified offset. The
disassembled original code will be written into orig.asm, the devilution code into compare.asm.

Note that the disassembler will use the function offset read from the PDB for both decompilations in order to align the
addresses in the output files (including relative jumps).

USAGE:
    devilution-comparer.exe [FLAGS] <DIABLO_FILE> <DEVILUTION_FILE> <DIABLO_OFFSET_START> <DEBUG_SYMBOL>

FLAGS:
    -h, --help           Prints help information
        --no-imms        Hides all immediate values. Use only with caution.
        --no-mem-disp    Hide memory displacements and indirect calls. This cleans up the output tremendously, but can
                         cause you to miss wrong stack variables or globals. Use only with caution.
    -i, --show-ip        Shows leading addresses in the output.
    -V, --version        Prints version information
    -w, --watch          Enable watching for changes to the PDB file, updating the output files on change.

ARGS:
    <DIABLO_FILE>            Path to the original Diablo.exe to use
    <DEVILUTION_FILE>        Sets the debug binary file to use. The respective .pdb file needs to exist in the same
                             folder as well. Currently for files generated by VC6 only.
    <DIABLO_OFFSET_START>    Offset into the original file, decimal or hex number (0xDEADBEEF)
    <DEBUG_SYMBOL>           Function name/debug symbol to compare. This also defines the length of code in the
                             original file to compare to.
```